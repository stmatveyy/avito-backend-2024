# Сборка приложения
1. В `docker-compose.yml` **без кавычек** добавить переменные окружения в раздел `environment`
2. Из корневой папки выполнить `docker compose up --build`

API будет доступен по http://<SERVER_ADDRESS>
Ошибка `Could not connect to database (Parametrs not provided)` при сборке будет означать, что переменные окружения для Postges переданы неверно\n
Ошибка `Connection parameters not provided. Need SERVER_ADDRESS env variable` значит, что SERVER_ADDRESS передан неверно/отсутствует\n

# Конфигурация линтера
Описана в файле .pylintrc

# Важно
## Система версий

По состоянию на 13.09 в текущем варианте БД **отсутствует** способ различать один и тот же тендер или предложение разных версий.\n
Чтобы все правильно работало, в поле id записывается тот же айди с 1 символом "\*" на конце для каждой новой правки.\n
К примеру, для тендера или предложения с id `c4f56...65` его вторая версия будет иметь id `c4f56...65*`. \n
При этом соблюдаются все требования по типам, так как id является строкой.\n

Id меняется при изменении тендера/предложения или его rollback`e. 
Самая последняя версия будет иметь больше всего звезд.

Во все ручки, которые используют bidId или tenderId нужно передавать **только UUID4-like строку**, без звёзд.

Список таких ручек:
> - PUT /api/tenders/{tenderId}/rollback/{version}
> - GET /api/tenders/{tenderId}/status
> - PUT /api/tenders/{tenderId}/status
> - GET /api/bids/{tenderId}/list
> - GET /api/bids/{bidId}/status
> - PUT /api/bids/{bidId}/status
> - PATCH /api/bids/{bidId}/edit
> - PUT /api/bids/{bidId}/rollback/{version}
> - PATCH /api/tenders/{tenderId}/edit
> - POST /api/bids/new
> - PUT /api/bids/{bidId}/submit_decision
> - PUT /api/bids/{bidId}/feedback
> - GET /api/{tenderId}/reviews

Такое решение *имеет* ботлнек, менять версию получится не больше maxLength(id) - len(UUID4) = 64 раз

## Система голосования

В БД нет способа считать текущее количество проголосовавших для каждого предложения, а хранить state вне персистентного хранилища - плохая практика.\n
Поэтому реализован неполный вариант, где для изменения решения по предложению достаточно одного голоса отвественного по организации. 
При `Approved` решении сразу удаляется связанный с предложением тендер.

## Отправка и получение отзывов

Отзыв автоматически отправляется на последнюю доступную версию. 
Если было два отзыва на разные версии одного отзыва, из `GET /api/{tenderId}/reviews` вернутся оба.

Так как в BidRewiew отсутствует внешний ключ BidId, id предложения записывается напрямую в поле BidReview\.id, которое используется как указанный внешний ключ

## Дополнительные фишки
В ручки 
`GET /api/tenders`
 `GET /api/bids/my` 
можно передать необязательный bool `only_new=True` 
Так будут отображаться только тендеры/предложения только последней версии.

